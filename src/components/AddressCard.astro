---
// AddressCard.astro
export interface Props {
  title?: string;
  description?: string;
  addressLine1: string;
  addressLine2?: string;
  city: string;
  province: string;
  postalCode: string;
  country: string;
  latitude?: number;
  longitude?: number;
}

const {
  title = "Location",
  description = "",
  addressLine1,
  addressLine2 = "",
  city,
  province,
  postalCode,
  country,
  latitude,
  longitude,
} = Astro.props;

const fullAddress = `${addressLine1}${addressLine2 ? ", " + addressLine2 : ""}, ${city}, ${province} ${postalCode}, ${country}`;
const googleMapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(fullAddress)}`;

const mapLat = latitude || (postalCode === "M8V 3Y3" ? 43.6022 : 43.6532);
const mapLng = longitude || (postalCode === "M8V 3Y3" ? -79.505 : -79.3832);

// Create bounding box around the location (roughly 1km radius)
const bbox = `${mapLng - 0.008},${mapLat - 0.006},${mapLng + 0.008},${mapLat + 0.006}`;
const osmMapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${bbox}&layer=mapnik&marker=${mapLat},${mapLng}`;
---

<div
  class="slide-in-up grid grid-cols-1 md:grid-cols-2 min-h-96 rounded-xl overflow-hidden shadow-md my-10 max-w-7xl mx-auto"
>
  <div class="flex flex-col justify-center p-6 sm:p-8 lg:p-12">
    <div class="mb-4">
      <span class="text-sm font-semibold tracking-wider opacity-80 uppercase"
        >{title}</span
      >
    </div>

    <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold leading-tight mb-6">
      Appointment<br />
    </h2>

    <div class="w-20 h-1 bg-yellow-400 mb-6"></div>

    {
      description && (
        <p class="text-lg leading-relaxed mb-8 opacity-90">
          {description}
          <span style="color: #011c4d; font-weight: bold;">
            info@karunalaw.ca
          </span>
        </p>
      )
    }

    <div
      class="flex items-start gap-4 text-blue-700 hover:text-blue-600 font-extrabold transition-colors duration-200"
    >
      <div class="flex-shrink-0 mt-1">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
            fill="currentColor"></path>
        </svg>
      </div>
      <div class="flex-1">
        <a
          href={googleMapsUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="no-underline hover:underline text-lg leading-relaxed"
        >
          <div class="mb-1">{addressLine1}</div>
          {addressLine2 && <div class="mb-1">{addressLine2}</div>}
          <div>{city}, {province} {postalCode}, {country}</div>
        </a>
      </div>
    </div>
  </div>

  <div class="relative p-4 bg-slate-50">
    <iframe
      src={osmMapUrl}
      width="100%"
      height="100%"
      style="border:0; min-height: 400px; filter: grayscale(100%);"
      allowfullscreen=""
      loading="lazy"
      title={`Map showing ${fullAddress}`}
      class="w-full h-full"></iframe>

    <!-- Map Pin Overlay -->
    <div
      class="absolute inset-0 flex items-center justify-center pointer-events-none"
    >
      <div class="transform -translate-y-6">
        <svg
          width="32"
          height="32"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="drop-shadow-lg"
        >
          <path
            d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
            fill="#EF4444"></path>
          <circle cx="12" cy="9" r="2.5" fill="white"></circle>
        </svg>
      </div>
    </div>
  </div>
</div>
